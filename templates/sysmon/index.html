{% extends "admin/index.html" %}
{% load sysmon_tags %}
{% block content %}
{% get_system_stats %}
<style>
    .cth {
        background-color: #eee;
    }
</style>

{% if user.is_superuser %}
<div class="module">
    {% if error_psutil %}
        <table width="100%">
            <caption>! ERROR (psutil not found)</caption>

            <tbody>
                <th>
                    - Please install psutil for view system statistics on this page
                    <br /><br />
                    $ pip install psutil
                </th>
            </tbody>
        </table>
    {% else %}
    	System Statistics
        <a href="#" onclick="
            var tbody_element = document.getElementById('body-sysmon');
            if(tbody_element.style.display == 'none') {
                tbody_element.style.display = '';
            } else {
                tbody_element.style.display = 'none';
            }
            return false;">
            (Toggle)
        </a>
        <div id="body-sysmon" style="display: none">
            <!-- CPU -->
                <h4>CPU</h4>
                <div class="progress">
					<div class="progress-bar{% if cpu_info.used > 90 %} progress-bar-danger{% elif cpu_info.used < 25 %} progress-bar-success{% endif %}" style="width:{{cpu_info.used|stringformat:"i"}}%;">
						{{cpu_info.used}}% | Core(s): {{cpu_info.core}}
					</div>
				</div>
            <!-- RAM -->
            <h4>Memory usage</h4>
        	<div class="progress">
				<div class="progress-bar{% if mem_info.used > 90 %} progress-bar-danger{% elif mem_info.used < 25 %} progress-bar-success{% endif %}" style="width:{{mem_info.used|stringformat:"i"}}%;">
					{{mem_info.used}}% | Total: {{mem_info.total}}
        		</div>
			</div>
            <!-- DISK -->
            <h4>Disks</h4>
            {% for part in partitions %}
            	<strong>{{part.mountpoint}}</strong>
            	<div class="progress">
					<div class="progress-bar{% if part.percent > 90 %} progress-bar-danger{% elif part.percent < 25 %} progress-bar-success{% endif %}" style="width:{{part.percent|stringformat:"i"}}%;">
						{{part.percent}}% | ({{part.total}})
	        		</div>
				</div>
            {% endfor %}

    <table class="table table-hover">
        <tbody>
            
            <!-- NETWORK -->
            <tr>
                <th colspan="5" class="cth">Networking</th>
            </tr>
            <tr>
                <th>Device</th>
                <th>Recv</th>
                <th>Sent</th>
                <th>Pkg Sent</th>
                <th>Pkg Recv</th>
            </tr>
            {% for network in networks %}
            <tr>
                <td>{{network.device}}</td>
                <td>{{network.recv}}</td>
                <td>{{network.sent}}</td>
                <td>{{network.pkg_sent}}</td>
                <td>{{network.pkg_recv}}</td>
            </tr>
            {% endfor %}
            <!-- PROCESSES -->
            <tr>
                <th colspan="5" class="cth">Processes by memory usage</th>
            </tr>
            <tr>
                <th>Name</th>
                <th>PID</th>
                <th>Mem</th>
                <th>Status</th>
                <th>User</th>
            </tr>
            {% for process in processes %}
            <tr>
                <td class="process">{{process.name}}</td>
                <td>{{process.pid}}</td>
                <td>{{process.memory}}%</td>
                <td>{{process.status}}</td>
                <td>{{process.user}}</td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
</div>
{% endif %}
{% endif %}
{{ block.super }}
{% endblock %}